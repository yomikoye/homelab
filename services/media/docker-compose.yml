services:
  jellyfin:
    container_name: jellyfin
    image: jellyfin/jellyfin:latest
    environment:
      - TZ=Europe/Warsaw
      - JELLYFIN_PublishedServerUrl=https://jellyfin.koye.casa
    volumes:
      - /mnt/shared/portainer/jellyfin/config:/config
      - /mnt/shared/portainer/jellyfin/cache:/cache
      - /mnt/shared/media:/media:ro
    ports:
      - "7359:7359/udp" # Auto-discovery
      - "1900:1900/udp" # DLNA
      - "8096:8096/tcp" 
    networks:
      - homelab-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jellyfin.rule=Host(`jellyfin.koye.casa`)"
      - "traefik.http.routers.jellyfin.tls=true"
      - "traefik.http.services.jellyfin.loadbalancer.server.port=8096"
    restart: unless-stopped
    devices:
      - /dev/dri:/dev/dri # Hardware acceleration (if available)

  audiobookshelf:
    container_name: audiobookshelf
    image: ghcr.io/advplyr/audiobookshelf:latest
    environment:
      - TZ=Europe/Warsaw
    volumes:
      - /mnt/shared/portainer/audiobookshelf/config:/config
      - /mnt/shared/library/audiobooks:/media:ro
    networks:
      - homelab-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.audiobookshelf.rule=Host(`audible.koye.casa`)"
      - "traefik.http.routers.audiobookshelf.tls=true"
      - "traefik.http.services.audiobookshelf.loadbalancer.server.port=80"
    restart: unless-stopped

  calibrewa:
    image: crocodilestick/calibre-web-automated:latest
    container_name: calibrewa
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Warsaw
      - HARDCOVER_TOKEN=${HARDCOVER_TOKEN}
      - NETWORK_SHARE_MODE=false
    
    volumes:
      - /mnt/shared/portainer/calibrewa/config:/config
      - /mnt/shared/library/book-ingest:/cwa-book-ingest
      - /mnt/shared/library/books:/calibre-library
      - /mnt/shared/portainer/calibrewa/plugins:/config/.config/calibre/plugins
    networks:
      - homelab-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.calibre-web-automated.rule=Host(`books.koye.casa`)"
      - "traefik.http.routers.calibre-web-automated.tls=true"
      - "traefik.http.services.calibre-web-automated.loadbalancer.server.port=8083"
    restart: unless-stopped

  savebooks:
    image: ghcr.io/calibrain/calibre-web-automated-book-downloader-tor:latest
    container_name: savebooks
    environment:
      - FLASK_PORT=8084
      - LOG_LEVEL=info
      - BOOK_LANGUAGE=en
      - USE_BOOK_TITLE=true
      - TZ=Europe/Warsaw
      - USING_TOR=true
      - APP_ENV=prod
    cap_add:
      - NET_ADMIN
      - NET_RAW
    volumes:
      - /mnt/shared/library/book-ingest:/cwa-book-ingest
    networks:
      - homelab-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.calibre-web-automated-book-downloader-tor.rule=Host(`savebooks.koye.casa`)"
      - "traefik.http.routers.calibre-web-automated-book-downloader-tor.tls=true"
      - "traefik.http.services.calibre-web-automated-book-downloader-tor.loadbalancer.server.port=8084"
    restart: unless-stopped

  kavita:
    container_name: kavita
    image: jvmilazz0/kavita:latest
    environment:
      - TZ=Europe/Warsaw
    volumes:
      - /mnt/shared/portainer/kavita/config:/kavita/config
      - /mnt/shared/library/books:/books:ro
      - /mnt/shared/library/comics:/comics
      - /mnt/shared/library/manga:/manga
    networks:
      - homelab-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.kavita.rule=Host(`kavita.koye.casa`)"
      - "traefik.http.routers.kavita.tls=true"
      - "traefik.http.services.kavita.loadbalancer.server.port=5000"
    restart: unless-stopped

  # calibre:
  #   image: ghcr.io/linuxserver/calibre
  #   container_name: calibre
  #   environment:
  #     - TZ=Europe/Warsaw
  #   volumes:
  #     - /mnt/shared/portainer/calibre/config:/config
  #     - /mnt/shared/portainer/calibre/uploads:/uploads
  #     - /mnt/shared/portainer/calibre/plugins:/plugins
  #     - /mnt/shared:/books
  #   networks:
  #     - homelab-network
  #   labels:
  #     - "traefik.enable=true"
  #     - "traefik.http.routers.calibre.rule=Host(`calibre.koye.casa`)"
  #     - "traefik.http.routers.calibre.tls=true"
  #     - "traefik.http.services.calibre.loadbalancer.server.port=8080"
  #   restart: unless-stopped

  # calibre-web:
  #   image: linuxserver/calibre-web:nightly
  #   container_name: calibre-web
  #   environment:
  #     - TZ=Europe/Warsaw
  #     - DOCKER_MODS=linuxserver/mods:universal-calibre
  #   volumes:
  #     - /mnt/shared/portainer/calibre-web/config:/config
  #     - /mnt/shared:/books
  #     - /mnt/shared/portainer/calibre/config:/config/calibre
  #   networks:
  #     - homelab-network
  #   labels:
  #     - "traefik.enable=true"
  #     - "traefik.http.routers.calibre-web.rule=Host(`library.koye.casa`)"
  #     - "traefik.http.routers.calibre-web.tls=true"
  #     - "traefik.http.services.calibre-web.loadbalancer.server.port=8083"
  #   restart: unless-stopped

  # readarr:
  #   image: lscr.io/linuxserver/readarr:develop
  #   container_name: readarr
  #   environment:
  #     - TZ=Europe/Warsaw
  #   depends_on:
  #     - calibre
  #     - calibre-web
  #   volumes:
  #     - /mnt/shared/portainer/readarr/config:/config
  #     - /mnt/shared/portainer/readarr/downloads:/downloads
  #     - /mnt/shared:/books
  #   networks:
  #     - homelab-network
  #   labels:
  #     - "traefik.enable=true"
  #     - "traefik.http.routers.readarr.rule=Host(`readarr.koye.casa`)"
  #     - "traefik.http.routers.readarr.tls=true"
  #     - "traefik.http.services.readarr.loadbalancer.server.port=8787"
  #   restart: unless-stopped

networks:
  homelab-network:
    name: homelab-network
    external: true